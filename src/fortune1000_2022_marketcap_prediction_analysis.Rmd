---
title: "R Analysis of the 2022 Fortune 1000 for Market Cap Prediction"
author: "Stefanus Bernard Melkisedek"
date: "2024-03-07"
output: 
    prettydoc::html_pretty:
        theme: cayman
        highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.path = "../figures/")
```


## Introduction
Fortune, an American Business Magazine, annually publishes the Fortune 500, a ranking of the top 500 firms based on their income. **This dataset comprises the complete Fortune 1000, rather than solely the top 500**.


**The objective of this capstone project is** to analyze the 2022 Fortune 1000 firms in order **to make predictions regarding their market value**. The dataset is sourced from the Kaggle website: [2022 Fortune 1000](https://www.kaggle.com/datasets/winston56/fortune-500-data-2021/data). The **dataset provides updated U.S. firm data for the year 2022**, replacing the previous data from 2021.


## load the libraries
The following libraries will be used in this analysis:

```{r load-packages, message=FALSE, warning=FALSE}
# tidyverse: Collection of packages for data manipulation and visualization
library(tidyverse)

# knitr: Enables dynamic report generation
library(knitr)

# kableExtra: Helps build common complex tables and manipulate table styles
library(kableExtra)

# janitor: Provides simple tools for examining and cleaning dirty data
library(janitor)

# skimr: Provides summary statistics for data exploration
library(skimr)

# broom: Converts statistical analysis objects into tidy format
library(broom)

# car: Companion to Applied Regression, provides tools for regression analysis
library(car)

# MASS: Support functions and datasets for Venables and Ripley's MASS
library(MASS)

# modelr: Provides functions for modelling that help with data tidying
library(modelr)
```

## Business Questions
The following are the business questions that will be addressed in this analysis:

```{r table-business-question, echo=FALSE}
# Define the business questions
business_questions <- data.frame(
  'No.' = c(1, 2, 3),
  'Business_Question' = c(
    'How can we accurately predict the market cap of companies entering the Fortune 1000 list for the first time (Newcomer="yes") based on the available data from the previous year (2022)?',
    'How can we predict the future market cap of companies already present on the 2022 Fortune 1000 list (Newcomer="no") by analyzing the changes in their financial metrics like revenue, profit, and number of employees, along with other factors like rank change, CEO demographics, and sector?',
    'What are the key factors (financial, company-related, or others) that have the most significant influence on the market cap of companies within different sectors present in the Fortune 1000 list?'
  )
)

# Create the table
business_questions %>%
  kable("html") %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, bold = TRUE) %>%
  row_spec(0, align = "c", bold = TRUE)
```

## Data Wrangling

### Gathering the Data
The dataset is loaded from the CSV file and stored in a dataframe called `fortune_df`.

```{r load-data, echo=TRUE}
# Load the dataset
fortune_df <- read_csv("../data/Fortune_1000.csv")
```

### Assessing the Data
The following steps are taken to assess the dataset:

1. **Data Structure**: The structure of the dataset is examined to understand the number of rows and columns, as well as the data types of the columns.

```{r head-fortune-df, echo=TRUE}
# Display the first six rows of the dataset
head(fortune_df)
```

```{r data-structure, echo=TRUE}
# Display the structure of the dataset
str(fortune_df)
```

As we can see from the data structures, this **dataset contains 1000 rows and 18 columns**, with a mix of numerical and categorical data types. 

**Based on the data types of the columns**, there is one column that needs to be converted to a double data type. The `Market Cap` column is **currently a character data type**, but **it should be a double data type**.

2. **Summary Statistics**: The summary statistics of the dataset are examined to understand the distribution of the data.

```{r summary-statistics, echo=TRUE}
# Display the summary statistics of the dataset
skim_without_charts(fortune_df)
```

3. **Missing Values**: The presence of missing values in the dataset is checked.

The summary data table shows that there are **Two column that have missing values** in the data type character and there are **Three columns that have missing values** from the data type numeric.

The columns from data type character with missing values are:
   - `Ticker`: 49 missing value
   - `Market Cap`: 1 missing value

`Ticker` **is the unique symbol of publicly traded** companies, so it is not a problem if there are **missing values in the ticker column, it means that company is a private company**. But, the `Market Cap` column is important for the analysis, so the missing value in this column needs to be handled.

The columns from data type numeric with missing values are:
- `profit`: 3 missing value
- `num. of employees`: 1 missing value
- `prev_rank`: 531 missing value

`prev_rank` indicates the previous rank of the company, so it is not a problem if there are **missing values in the prev_rank column, it means that company is not listed in the top 500 companies last year**. But, the `profit` and `num. of employees` columns are important for the analysis, so the missing value in these columns needs to be handled.

4. **Duplicate Rows**: The presence of duplicate rows in the dataset is checked.

To see the duplicate rows in the dataset, the `duplicated()` function is used to check for duplicate rows. The result shows that there are no duplicate rows in the dataset.

```{r duplicate-rows, echo=TRUE}
# Check for duplicate rows
fortune_df[duplicated(fortune_df), ]

# Count the number of duplicate rows and save it to a variable
duplicate_rows <- fortune_df[duplicated(fortune_df), ] %>% nrow()

# Display the number of duplicate rows
print(glue::glue("The number of duplicate rows in the dataset is {duplicate_rows}."))
```

**There are no duplicate rows** in the dataset, so let's move on to the next step.

5. **Column Names**: The column names are examined to ensure they are consistent and easy to work with.

The column names are not consistent and contain spaces and special characters. The column names with these criteria are as follows:
   - `num. of employees`
   - `CEO`
   - `Website`
   - `Ticker`
   - `Market Cap`

6. **Unique Values**: The unique values of the categorical columns are examined to understand the different categories present in the dataset.

To check the unique values of the categorical columns, the `unique()` function is used to display the unique values of the `Sector` and `Industry` columns.

```{r sector-unique-values, echo=TRUE}
# Display the unique values of the Sector Industry columns
unique_sector <- fortune_df %>% 
  distinct(sector)

unique_sector %>% kable()
```

```{r city-unique-values, echo=TRUE}
# Display the unique values of the City column
# unique_city <- fortune_df %>% 
#   distinct(city)
# 
# unique_city %>% kable()
```

```{r state-unique-values, echo=TRUE}
# Display the unique values of the State column
unique_state <- fortune_df %>% 
  distinct(state)

unique_state %>% kable()
```



7. **Outliers**: The presence of outliers in the numerical columns is checked.

To check for outliers in the numerical columns, the `boxplot()` function is used to create boxplots for the `revenue`, `profit`, and `num. of employees` columns.

```{r boxplot-revenue, echo=TRUE}
# Create a boxplot for the revenue column
ggplot(data = fortune_df) + 
  geom_boxplot(mapping = aes(x = revenue), colour = "#15925e") +
  labs(title = "Boxplot of Revenue") +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  )
```

```{r boxplot-profit, echo=TRUE}
# Create a boxplot for the profit column
ggplot(data = fortune_df) + 
  geom_boxplot(mapping = aes(x = profit), colour = "#15925e") +
  labs(title = "Boxplot of Profit") +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  )
```

From the `profit` and revenue `boxplot`, we could conclude that there are some company with a very high revenue and profit. But, it is not an outlier, because it is a common thing in the business world. So, we could conclude that there are no outliers in the revenue and profit columns.


8. **Data Quality**: The overall quality of the dataset is assessed.

The assessment of the dataset is summarized in the table below:

**Table of Summary Assessment**

``` {r summary-assessment, echo=TRUE}
# Check for missing values
missing_values <- vapply(fortune_df, function(x) sum(is.na(x)), FUN.VALUE = numeric(1))

# Check for duplicate rows
duplicate_rows <- anyDuplicated(fortune_df)

# Get data types
data_types <- vapply(fortune_df, function(x) class(x)[1], FUN.VALUE = character(1))

# Combine all into a data frame
assessment_df <- data.frame(
  MissingValues = missing_values,
  DuplicateRows = duplicate_rows,
  DataTypes = data_types
)

# Show the assessment table
assessment_df %>% kable()
```

