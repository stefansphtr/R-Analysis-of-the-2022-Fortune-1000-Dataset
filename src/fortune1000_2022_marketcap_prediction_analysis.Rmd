---
title: "R Analysis of the 2022 Fortune 1000 Dataset"
author: "Stefanus Bernard Melkisedek"
date: "2024-03-07"
output: 
    prettydoc::html_pretty:
        theme: cayman
        highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.path = "../figures/", fig.width = 12, fig.height = 8, fig.align = "center")
```

## Introduction

Fortune, an American Business Magazine, annually publishes the Fortune
500, a ranking of the top 500 firms based on their income. **This
dataset comprises the complete Fortune 1000, rather than solely the top
500**.

**The objective of this capstone project is** to analyze the 2022
Fortune 1000 firms in order **to analyze and gain insight from the data**. The dataset is sourced from the Kaggle website: [2022 Fortune
1000](https://www.kaggle.com/datasets/winston56/fortune-500-data-2021/data).
The **dataset provides updated U.S. firm data for the year 2022**,
replacing the previous data from 2021.

## load the libraries

The following libraries will be used in this analysis:

```{r load-packages, message=FALSE, warning=FALSE}
# tidyverse: Collection of packages for data manipulation and visualization
library(tidyverse)

# knitr: Enables dynamic report generation
library(knitr)

# kableExtra: Helps build common complex tables and manipulate table styles
library(kableExtra)

# janitor: Provides simple tools for examining and cleaning dirty data
library(janitor)

# skimr: Provides summary statistics for data exploration
library(skimr)

# reshape2: Flexibly restructure and aggregate data
library(reshape2)
```

## Business Questions

The following are the business questions that will be addressed in this
analysis:

```{r table-business-question, echo=FALSE}
# Define the business questions
business_questions <- data.frame(
  'No.' = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10),
  'Business_Question' = c(
    'What percentage of companies have women ceo\'s?',
    'How many companies are newcomers?',
    'What percentage of companies have ceos who were also founders?',
    'What role does profitability play in ranking?',
    'How many companies with a market cap of over $100 billion are there?',
    'What is the average revenue of companies with a market cap of over $100 billion?',
    'What is the average profit of companies with a market cap of over $100 billion?',
    'What is the average number of employees of companies with a market cap of over $100 billion?',
    'What is the average rank of companies with a market cap of over $100 billion?',
    'What is the sector with the highest average market cap?'
  )
)

# Create the table
business_questions %>%
  kable("html") %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, bold = TRUE) %>%
  row_spec(0, align = "c", bold = TRUE)
```

## Data Wrangling

### Gathering the Data

The dataset is loaded from the CSV file and stored in a dataframe called
`fortune_df`.

```{r load-data, echo=TRUE}
# Load the dataset
fortune_df <- read_csv("../data/Fortune_1000.csv")
```

### Assessing the Data

The following steps are taken to assess the dataset:

1.  **Data Structure**: The structure of the dataset is examined to
    understand the number of rows and columns, as well as the data types
    of the columns.

```{r head-fortune-df, echo=TRUE}
# Display the first six rows of the dataset
head(fortune_df)
```

```{r data-structure, echo=TRUE}
# Display the structure of the dataset
str(fortune_df)
```

As we can see from the data structures, this **dataset contains 1000
rows and 18 columns**, with a mix of numerical and categorical data
types.

**Based on the data types of the columns**, there is one column that
needs to be converted to a double data type. The `Market Cap` column is
**currently a character data type**, but **it should be a double data
type**.

2.  **Summary Statistics**: The summary statistics of the dataset are
    examined to understand the distribution of the data.

```{r summary-statistics, echo=TRUE}
# Display the summary statistics of the dataset
skim_without_charts(fortune_df)
```

3.  **Missing Values**: The presence of missing values in the dataset is
    checked.

The summary data table shows that there are **Two column that have
missing values** in the data type character and there are **Three
columns that have missing values** from the data type numeric.

The columns from data type character with missing values are: -
`Ticker`: 49 missing value - `Market Cap`: 1 missing value

`Ticker` **is the unique symbol of publicly traded** companies, so it is
not a problem if there are **missing values in the ticker column, it
means that company is a private company**. But, the `Market Cap` column
is important for the analysis, so the missing value in this column needs
to be handled.

The columns from data type numeric with missing values are: - `profit`:
3 missing value - `num. of employees`: 1 missing value - `prev_rank`:
531 missing value

`prev_rank` indicates the previous rank of the company, so it is not a
problem if there are **missing values in the prev_rank column, it means
that company is not listed in the top 500 companies last year**. But,
the `profit` and `num. of employees` columns are important for the
analysis, so the missing value in these columns needs to be handled.

4.  **Duplicate Rows**: The presence of duplicate rows in the dataset is
    checked.

To see the duplicate rows in the dataset, the `duplicated()` function is
used to check for duplicate rows. The result shows that there are no
duplicate rows in the dataset.

```{r duplicate-rows, echo=TRUE}
# Check for duplicate rows
fortune_df[duplicated(fortune_df), ]

# Count the number of duplicate rows and save it to a variable
duplicate_rows <- fortune_df[duplicated(fortune_df), ] %>% nrow()

# Display the number of duplicate rows
print(glue::glue("The number of duplicate rows in the dataset is {duplicate_rows}."))
```

**There are no duplicate rows** in the dataset, so let's move on to the
next step.

5.  **Column Names**: The column names are examined to ensure they are
    consistent and easy to work with.

The column names are not consistent and contain spaces and special
characters. The column names with these criteria are as follows: -
`num. of employees` - `CEO` - `Website` - `Ticker` - `Market Cap`

6.  **Unique Values**: The unique values of the categorical columns are
    examined to understand the different categories present in the
    dataset.

To check the unique values of the categorical columns, the `unique()`
function is used to display the unique values of the `Sector` and
`Industry` columns.

```{r sector-unique-values, echo=TRUE}
# Display the unique values of the Sector Industry columns
unique_sector <- fortune_df %>% 
  distinct(sector)

unique_sector %>% kable()
```

```{r city-unique-values, echo=TRUE}
# Display the unique values of the City column
# unique_city <- fortune_df %>% 
#   distinct(city)
# 
# unique_city %>% kable()
```

```{r state-unique-values, echo=TRUE}
# Display the unique values of the State column
unique_state <- fortune_df %>% 
  distinct(state)

unique_state %>% kable()
```

7.  **Outliers**: The presence of outliers in the numerical columns is
    checked.

To check for outliers in the numerical columns, the `boxplot()` function
is used to create boxplots for the `revenue`, `profit`, and
`num. of employees` columns.

```{r boxplot-revenue, echo=TRUE}
# Create a boxplot for the revenue column
ggplot(data = fortune_df) +
  geom_boxplot(mapping = aes(x = revenue), colour = "#15925e") +
  labs(title = "Boxplot of Revenue") +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  )
```

```{r boxplot-profit, echo=TRUE}
# Create a boxplot for the profit column
ggplot(data = fortune_df) + 
  geom_boxplot(mapping = aes(x = profit), colour = "#15925e") +
  labs(title = "Boxplot of Profit") +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  )
```

From the `profit` and revenue `boxplot`, we could conclude that there
are some company with a very high revenue and profit. But, it is not an
outlier, because it is a common thing in the business world. So, we
could conclude that there are no outliers in the revenue and profit
columns.

8.  **Data Quality**: The overall quality of the dataset is assessed.

The assessment of the dataset is summarized in the table below:

**Table of Summary Assessment**

```{r summary-assessment, echo=TRUE}
# Check for missing values
missing_values <- vapply(fortune_df, function(x) sum(is.na(x)), FUN.VALUE = numeric(1))

# Check for duplicate rows
duplicate_rows <- anyDuplicated(fortune_df)

# Get data types
data_types <- vapply(fortune_df, function(x) class(x)[1], FUN.VALUE = character(1))

# Combine all into a data frame
assessment_df <- data.frame(
  MissingValues = missing_values,
  DuplicateRows = duplicate_rows,
  DataTypes = data_types
)

# Show the assessment table
assessment_df %>% kable()
```

### Cleaning the Data

The following steps are taken to clean the dataset:

1.  **Handling the column names**

```{r column-names, echo=TRUE}
# Clean the column names with janitor
fortune_df <- fortune_df %>% 
  clean_names()

# Check the cleaned column names
colnames(fortune_df)
```

2.  **Handling the data types**

```{r data-types, echo=TRUE}
# Convert the Market Cap column to a double data type
fortune_df <- fortune_df %>% 
  mutate(market_cap = as.numeric(market_cap))

# Check if the data type of the Market Cap column has been converted
data_type_market_cap <- class(fortune_df$market_cap)
glue::glue("The data type of the Market Cap column is {data_type_market_cap}.")
```

3.  **Handling the missing value**

```{r missing-value-profit, echo=TRUE}
# View the records with missing values in the profit feature
fortune_df %>% 
  filter(is.na(profit)) %>% 
  kable()

# Fill the missing values in the profit column with the median value
fortune_df <- fortune_df %>% 
  mutate(profit = ifelse(is.na(profit), median(profit, na.rm = TRUE), profit))

# Check if the missing values in the profit column have been handled
missing_values_profit <- sum(is.na(fortune_df$profit))
glue::glue("The number of missing values in the profit column is {missing_values_profit}.")
```

```{r missing-value-employees, echo=TRUE}
# View the records with missing values in the num_of_employees feature
fortune_df %>% 
  filter(is.na(num_of_employees)) %>%
  kable()
```

As we can see, there is no ticker(stock ticker symbol) in the
`Univision Communications` company that tells this is a private company,
so we could fill the missing value in the `num_of_employees` column with
0

```{r fill-missing-value-employees, echo=TRUE}
# Fill the missing values in the num_of_employees column with 0
fortune_df <- fortune_df %>% 
  mutate(num_of_employees = ifelse(is.na(num_of_employees), 0, num_of_employees))

# Check if the missing values in the num_of_employees column have been handled
missing_values_employees <- sum(is.na(fortune_df$num_of_employees))
glue::glue("The number of missing values in the num_of_employees column is {missing_values_employees}.")
```

```{r missing-value-ticker, echo=TRUE}
# Check the missing values in the Ticker feature
missing_values_ticker <- fortune_df %>% 
  filter(is.na(ticker)) %>%
  nrow()

glue::glue("The number of missing values in the Ticker column is {missing_values_ticker}.")
```

```{r fill-missing-value-ticker, echo=TRUE}
# Fill the missing values in the Ticker column with "Private"
fortune_df <- fortune_df %>% 
  mutate(ticker = ifelse(is.na(ticker), "Private", ticker))

# Check if the missing values in the Ticker column have been handled
missing_values_ticker <- sum(is.na(fortune_df$ticker))
glue::glue("The number of missing values in the Ticker column is {missing_values_ticker}.")
```

```{r missing-value-prev-rank, echo=TRUE}
# Check again the number of missing values in the prev_rank column
missing_values_prev_rank <- fortune_df %>% 
  filter(is.na(prev_rank)) %>%
  nrow()

glue::glue("The number of missing values in the prev_rank column is {missing_values_prev_rank}.")
```

```{r fill-missing-value-prev-rank, echo=TRUE}
# Fill the missing values in the prev_rank column with 0
fortune_df <- fortune_df %>% 
  mutate(prev_rank = ifelse(is.na(prev_rank), 0, prev_rank))

# Check if the missing values in the prev_rank column have been handled
missing_values_prev_rank <- sum(is.na(fortune_df$prev_rank))
glue::glue("The number of missing values in the prev_rank column is {missing_values_prev_rank}.")
```

```{r missing-value-market-cap, echo=TRUE}
# View the records with missing values in the Market Cap feature
fortune_df %>% 
  filter(is.na(market_cap)) %>% 
  kable()
```

```{r fill-missing-value-market-cap, echo=TRUE}
# Fill the missing values in the Market Cap using median value
fortune_df <- fortune_df %>% 
  mutate(market_cap = ifelse(is.na(market_cap),
  median(market_cap, na.rm = TRUE), market_cap))

# Check if the missing values in the Market Cap column have been handled
missing_values_market_cap <- sum(is.na(fortune_df$market_cap))
glue::glue("The number of missing values in the Market Cap column is {missing_values_market_cap}.")
```

Now, let's check again for the overall missing values using the skimr
package.

```{r missing-values-overall, echo=TRUE}
# Display the summary statistics of the dataset
skim_without_charts(fortune_df)
```

Since the unique values of the ceo feature is 994, It seems that there
are duplicate values in the ceo feature. Let's check for the duplicate
values in the ceo feature.

```{r duplicate-values-ceo, echo=TRUE}
# Check for duplicate values in the ceo feature
duplicate_ceo <- fortune_df %>% 
  group_by(ceo) %>% 
  summarize(n = n()) %>%
  filter(n > 1)

# Display the duplicate values in the ceo feature
duplicate_ceo %>% kable()
```

From the table above, we could see that `Elon Musk` and
`Vincent T. Roche` are the CEO of two companies.

Let's check it out first what companies are they leading.

```{r check-ceo-companies, echo=TRUE}
# Check the companies that Elon Musk and Vincent T. Roche are leading
fortune_df %>% 
  dplyr::filter(ceo == "Elon Musk" | ceo == "Vincent T. Roche") %>%
  dplyr::select(company, ceo) %>% 
  kable()
```

So, it is not a duplicate value, it is a common thing in the business
world.

Next, we would like to check the ceo with name `#REF`. Let's check it
out first what company is he leading.

```{r check-ceo-ref, echo=TRUE}
# Check the company that the CEO with name #REF is leading
fortune_df %>% 
  dplyr::select(company, ceo) %>% 
  dplyr::filter(ceo == "#REF!") %>%
  kable()
```

It seems there are companies with the CEO named `#REF!`, this would be
causing by the The `#REF!` error typically **appears when a reference is
not valid**. This is common in spreadsheet software like Excel, where it
can occur if a formula refers to a cell that doesn't exist, usually
because the cell's row or column has been deleted.

```{r fill-missing-value-ceo, echo=TRUE}
# Fill the missing values in the ceo column with "Unknown"
fortune_df <- fortune_df %>% 
  mutate(ceo = ifelse(ceo == "#REF!", "Unknown", ceo))

# Check if the invalid values in the ceo column have been handled
invalid_values_ceo <- sum(fortune_df$ceo == "#REF!")
glue::glue("The number of invalid values in the ceo column is {invalid_values_ceo}.")
```

```{r list-of-numeric-columns, echo=TRUE}
# List of numeric columns
numeric_columns <- fortune_df %>% 
  dplyr::select(where(is.numeric)) %>% 
  colnames()

# View the column names of the numeric columns
numeric_columns
```

For the final step, let's check the distribution of the columns
`revenue`, `profit`, `num_of_employees`, and `market_cap` using the
`ggplot2` packages.

```{r distribution-revenue, echo=TRUE}
# Create a histogram for the revenue column
ggplot(data = fortune_df, aes(x = revenue)) +
  geom_histogram(fill = "#15925e", color = "black") +
  labs(
    title = "Distribution of Revenue (Log Scale)",
    x = "Revenue"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::dollar)
```

The `scale_x_log10()` function transforms the x-axis using a logarithmic
scale, which can be **useful when dealing with data that spans several
orders of magnitude**.

**In a logarithmic scale**, the **distance from 1 to 10 is the same as
the distance from 10 to 100**, or from 100 to 1000, and so on. This is
because each step on the scale is a multiplication by 10, rather than an
addition.

```{r distribution-profit, echo=TRUE}
# Create a histogram for the profit column
ggplot(data = fortune_df) +
  geom_histogram(mapping = aes(x = profit), fill = "#15925e", color = "black") +
  labs(
    title = "Distribution of Profit (Log Scale)",
    x = "Profit"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(labels = scales::dollar)
```

```{r distribution-market-cap, echo=TRUE}
# Create a histogram for the market_cap column
ggplot(data = fortune_df) +
  geom_histogram(mapping = aes(x = market_cap), fill = "#15925e", color = "black") +
  labs(
    title = "Distribution of Market Cap (Log Scale)",
    x = "Market Cap"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::dollar)
```

```{r distribution-employees, echo=TRUE}
# Create a histogram for the num_of_employees column
ggplot(data = fortune_df) +
  geom_histogram(mapping = aes(x = num_of_employees), fill = "#15925e", color = "black") +
  labs(
    title = "Distribution of Number of Employees (Log Scale)",
    x = "Number of Employees"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::comma)
```

As we can see on the distribution of `revenue` there is a **left-skewed
distribution**, it means that there are some companies with a very high
revenue. The distribution of `profit` and `market_cap` also have a
**left-skewed distribution**, it means that there are some companies
with a very high profit and market cap.

The distribution of `num_of_employees` have a **left-skewed
distribution**, it means that there are some companies with a very high
number of employees.

**Conclusion:**

-   The column names have been cleaned and are now consistent and easy
    to work with.

-   The `Market Cap` column has been converted to a **double data
    type**.

-   The missing values in the `profit`, `num_of_employees`, `ticker`,
    `prev_rank`, and `market_cap` columns have been **handled**.

-   The invalid values in the `ceo` column has been handled by filling
    the missing values with "Unknown".

**Additional Note for the outlier in the `revenue`, `market_cap` and
`profit` columns:**

-   The outlier in the `revenue`, `market_cap` and `profit` columns are
    not handled because it is a common thing in the business world.

## Exploratory Data Analysis

list of interesting questions to be answered in the exploratory data
analysis:

**Pre-analysis to see the statistic of the dataset**

-   **Univariate Analysis**:

    • **Question**: How is the market cap of existing companies
    (Newcomer="no") distributed? Are there any outliers that might
    require further investigation?

    • **Question**: How do features like revenue, profit, and number of
    employees for companies entering the list for the first time
    (Newcomer="yes") compare to existing companies in terms of
    distribution?

    • **Question**: What does the distribution of rank change look like
    for companies that entered the list (Newcomer="yes")?

-   **Bivariate Analysis**:

    • **Question**: Is there a visual relationship between market cap
    and features like revenue, profit, and number of employees for
    established companies (Newcomer="no")?

    • **Question**: How does the rank change of new entrants relate to
    their market cap?

    • **Question**: Do these relationships between market cap and other
    features differ across various sectors? (Use boxplots or violin
    plots to compare market cap distribution)



Now let's start analyze the statistic of the dataset.

### Pre-analysis Statistic

#### Univariate Analysis

Question 1: How is the market cap of existing companies (Newcomer="no")
distributed? Are there any outliers that might require further
investigation?

```{r existing-market-cap-distribution, echo=TRUE}
# Create the variable of existing_df for the existing companies
existing_df <- fortune_df %>% 
  filter(newcomer == "no")

# Create a histogram for the market cap of existing companies
ggplot(data = existing_df) +
  geom_histogram(mapping = aes(x = market_cap), fill = "#15925e", color = "black") +
  labs(
    title = "Distribution of Market Cap for Existing Companies (Log Scale)",
    x = "Market Cap"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::dollar)
```

```{r existing-market-cap-boxplot, echo=TRUE}
# Create a boxplot for the market cap of existing companies to identify outliers
ggplot(data = existing_df) +
  geom_boxplot(mapping = aes(x = market_cap), fill = "#15925e", color = "black") +
  labs(
    title = "Boxplot of Market Cap for Existing Companies (Log Scale)",
    x = "Market Cap"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::dollar)
```

The distribution of the market cap for existing companies is
**left-skewed**, with a few companies having very high market caps.

Let's see the list of existing companies with the highest market cap.

```{r highest-market-cap-companies, echo=TRUE}
# List of companies with the highest market cap
highest_market_cap_companies <- existing_df %>% 
  arrange(-market_cap) %>% 
  head(10)

highest_market_cap_companies %>% kable()
```

The top 10 of existing companies with the highest market cap are
**Apple, Microsoft, Alphabet, Amazon, Tesla, Berkshire Hathaway,
UnitedHealth Group, Visa, Meta Platforms, and Johnson & Johnson**.

Next, we should check the list of existing companies with the lowest
market cap.

```{r lowest-market-cap-companies, echo=TRUE}
# List of companies with the lowest market cap
lowest_market_cap_companies <- existing_df %>% 
  arrange(market_cap) %>% 
  head(10)

lowest_market_cap_companies %>% kable()
```

The lowest 10 of existing companies with the lowest market cap are
**Cooper-Standard Holdings, NGL Energy Partners, R.R. Donnelley & Sons,
Yellow, Vroom, Hovnanian Enterprises, Quad/Graphics, Party City Holdco,
Olympic Steel, and Sprague Resources**.

**Conclusion:**

Since **the top 10 of existing companies with the highest market cap are
well-known companies**, it is not an outlier. The same thing goes for
the lowest 10 of existing companies with the lowest market cap, it is
not an outlier. **So, there are no outliers that need further
investigation**.


Question 2: How do features like revenue, profit, and number of employees for companies entering the list for the first time (Newcomer="yes") compare to existing companies in terms of distribution?

```{r compare-revenue-distribution, echo=TRUE}
# Create the variable of new_entrants_df for the new entrants
new_entrants_df <- fortune_df %>% 
  filter(newcomer == "yes")

# Compare the distribution of revenue for new entrants and existing companies
ggplot(data = fortune_df) +
  geom_histogram(aes(
    x = revenue, 
    fill = newcomer, 
    color = newcomer,
  ), alpha = 0.5) +
  labs(
    title = "Distribution of Revenue for New Entrants and Existing Company (Log Scale)",
    x = "Revenue"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::dollar)
```

```{r compare-profit-distribution, echo=TRUE}
# Compare the distribution of profit for new entrants and existing companies
ggplot(data = fortune_df) +
  geom_histogram(aes(
    x = profit, 
    fill = newcomer, 
    color = newcomer,
  ), alpha = 0.5) +
  labs(
    title = "Distribution of Profit for New Entrants and Existing Company (Log Scale)",
    x = "Profit"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::dollar)
```

```{r compare-employees-distribution, echo=TRUE}
# Compare the distribution of number of employees for new entrants and existing companies
ggplot(data = fortune_df) +
  geom_histogram(aes(
    x = num_of_employees, 
    fill = newcomer, 
    color = newcomer,
  ), alpha = 0.5) +
  labs(
    title = "Distribution of Number of Employees for New Entrants and Existing Company (Log Scale)",
    x = "Number of Employees"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::comma)
```

**Conclusion**:

Based on the comparison distribution revenue, profit, and number of employees, we can conclude that between new entrants and existing companies, **there are significant differences in the distribution of these features. The distribution of revenue, profit, and number of employees for existing companies is dominating the distribution of new entrants.**


Question 3: What does the distribution of rank change look like for companies that entered the list (Newcomer="yes")?

```{r rank-change-distribution, echo=TRUE}
# Create a histogram for the rank change of new entrants
ggplot(data = new_entrants_df) +
  geom_histogram(mapping = aes(x = rank_change), fill = "#15925e", color = "black") +
  labs(
    title = "Distribution of Rank Change for New Entrants",
    x = "Rank Change"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  )
```

**Conclusion:** 

**There is no rank changes from the new entrants companies** because they are new in the list, and from the cleaning process I fill the missing value in the `prev_rank` column with 0, so the rank change is 0.

#### Bivariate Analysis

Question 1: Is there a visual relationship between market cap and features like revenue, profit, and number of employees for established companies (Newcomer="no")?

```{r relationship-market-cap-revenue, echo=TRUE}
# Create a scatter plot to visualize the relationship between market cap and revenue
ggplot(data = existing_df) +
  geom_point(mapping = aes(x = revenue, y = market_cap), color = "red") +
  geom_smooth(mapping = aes(x = revenue, y = market_cap), method = "lm", se = FALSE, color = "blue") +
  labs(
    title = "Relationship Between Market Cap and Revenue",
    x = "Revenue",
    y = "Market Cap"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::dollar) +
  scale_y_log10(label = scales::dollar)
```

```{r relationship-market-cap-profit, echo=TRUE}
# Create a scatter plot to visualize the relationship between market cap and profit
ggplot(data = existing_df) +
  geom_point(mapping = aes(x = profit, y = market_cap), color = "red") +
  geom_smooth(mapping = aes(x = profit, y = market_cap), method = "lm", se = FALSE, color = "blue") +
  labs(
    title = "Relationship Between Market Cap and Profit",
    x = "Profit",
    y = "Market Cap"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::dollar) +
  scale_y_log10(label = scales::dollar)
```

```{r relationship-market-cap-employees, echo=TRUE}
# Create a scatter plot to visualize the relationship between market cap and number of employees
ggplot(data = existing_df) +
  geom_point(mapping = aes(x = num_of_employees, y = market_cap), color = "red") +
  geom_smooth(mapping = aes(x = num_of_employees, y = market_cap), method = "lm", se = FALSE, color = "blue") +
  labs(
    title = "Relationship Between Market Cap and Number of Employees",
    x = "Number of Employees",
    y = "Market Cap"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  ) +
  scale_x_log10(label = scales::comma) +
  scale_y_log10(label = scales::dollar)
```

Conclusion:

Based on the scatter plots, we can see that there is a **positive linear relationship between market cap and revenue, profit, and number of employees**.
It means that the higher the revenue, profit, and number of employees, the higher the market cap.

But in the number of employees, the correlation seems not strong enough. Let's see the correlation between the market cap and the revenue, profit, and number of employees.

```{r correlation-market-cap, echo=TRUE}
# Calculate the correlation between market cap and revenue, profit, and number of employees
correlation_market_cap <- existing_df %>% 
  dplyr::select(market_cap, revenue, profit, num_of_employees) %>% 
  cor()

correlation_market_cap %>% kable()
```

It seems hard to see the correlation between the market cap and the revenue, profit, and number of employees from the table above. Let's visualize it using the `heatmap`.

```{r heatmap-correlation-market-cap, echo=TRUE}
# Convert the correlation matrix to a data frame
correlation_df <- reshape2::melt(correlation_market_cap)

# Create the heatmap
ggplot(data = correlation_df, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0, limits = c(-1, 1)) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, size = 12, hjust = 1),
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    legend.position = "none"
  ) +
  labs(
    title = "Correlation Between Market Cap and Revenue, Profit, and Number of Employees",
    x = "Features",
    y = "Features"
  )
```

**Conclusion:**

Based on the heatmap, we can see that there is a **strong positive correlation between market cap and revenue and profit**. But, there is a **weak positive correlation between market cap and the number of employees**, this means that the higher the revenue and profit, the higher the market cap, but number of employees has a small effect on the market cap.

Question 2: How does the rank change of new entrants relate to their market cap?

```{r relationship-rank-change-market-cap, echo=TRUE}
# Create a scatter plot to visualize the relationship between rank change and market cap for new entrants
ggplot(data = new_entrants_df) +
  geom_point(mapping = aes(x = rank_change, y = market_cap), color = "red") +
  geom_smooth(mapping = aes(x = rank_change, y = market_cap), method = "lm", se = FALSE, color = "blue") +
  labs(
    title = "Relationship Between Rank Change and Market Cap for New Entrants",
    x = "Rank Change",
    y = "Market Cap"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
  )
```

**Conclusion:**

There are no rank changes from the new entrants companies because they are new in the list, and from the cleaning process I fill the missing value in the `prev_rank` column with 0, so the rank change is 0, and the **market cap is not affected by the rank changes for the new entrants company**.

Question 3: Do these relationships between market cap and other features differ across various sectors? (Use boxplots or violin plots to compare market cap distribution)

```{r relationship-market-cap-sector, fig.width=20, fig.height=15, echo=TRUE}
# Define the aesthetics for the boxplot
boxplot_aesthetics <- aes(x = sector, y = market_cap)

# Define the boxplot geometry
boxplot_geometry <- geom_boxplot(fill = "#15925e", color = "black")

# Define the labels for the plot
plot_labels <- labs(
  title = "Comparison of Market Cap Distribution Across Various Sectors",
  x = "Sector",
  y = "Market Cap"
)

# Define the theme for the plot
plot_theme <- theme(
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  panel.background = element_blank(),
  axis.text.x = element_text(size = 10, vjust = 1, hjust = 0.5),
  plot.title = element_text(size = 30, hjust = 0.5, margin = margin(t = 0, r = 0, b = 30, l = 0))
)

# Define the scale for the y-axis
y_axis_scale <- scale_y_log10(label = scales::dollar)

# Create the plot
ggplot(data = existing_df) +
  boxplot_aesthetics +
  boxplot_geometry +
  plot_labels +
  plot_theme +
  y_axis_scale +
  facet_wrap(~sector, scales = "free")
```

**Conclusion:**

Based on the boxplot, we can see that **the distribution of market cap differs across various sectors**. The `Technology, Financials, and Apparel` sector has widely distributed market capitalization with **some of the companies leading the market cap**, while the **other sector has a narrow distribution** of market capitalization.

### Answer the Questions

**Question 1: What percentage of companies have women ceo's?**

```{r percentage-women-ceo, echo=TRUE}
# Calculate the percentage of companies with woman ceo
percentage_women_ceo <- fortune_df %>% 
  dplyr::filter(ceo_woman == "yes") %>% 
  nrow() / fortune_df %>%
  nrow() * 100

glue::glue("The percentage of companies who have women ceo is {percentage_women_ceo}%.")
```
```{r pie-chart-pct-women-ceo, echo=TRUE, fig.width=10, fig.height=8}
# Calculate the number of companies with and without a woman CEO
ceo_gender_df <- fortune_df %>% 
  dplyr::group_by(ceo_woman) %>% 
  dplyr::summarise(n = n()) %>% 
  dplyr::mutate(freq = n / sum(n))

# Create the pie chart
ggplot(ceo_gender_df, aes(x = "", y = freq, fill = ceo_woman)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  theme_void() +
  labs(fill = "Women CEO",
       title = "Percentage of Companies with Women CEOs") +
  scale_fill_manual(values = c("yes" = "blue", "no" = "red")) +
  geom_text(aes(label = scales::percent(freq)),
            position = position_stack(vjust = 0.5)) +
  theme(
    plot.title = element_text(size = 20, hjust = 0.5, margin = margin(t = 30, r = 0, b = 10, l = 0)),
  )
```

The companies with women CEO's are **only 8%** from the total companies.

**Question 2: How many companies are newcomers?**

```{r count-newcomers, echo=TRUE}
# Calculate the newcomers company
newcomers_count <- fortune_df %>% 
  dplyr::filter(newcomer == "yes") %>% 
  nrow()

glue::glue("The number of newcomers companies is {newcomers_count}.")

# Calculate the percentage of newcomers company
percentage_newcomers <- newcomers_count / fortune_df %>%
  nrow() * 100

glue::glue("The percentage of newcomers companies is {percentage_newcomers}%.")
```
Based on the calculation, there are only **3%** of newcomers companies from the total companies in the 1000 Fortune 2022.

**Question 3: What percentage of companies have ceos who were also the founders?**

```{r percentage-founder-ceo, echo=TRUE}
# Calculate the percentage of companies with founder ceo
percentage_founder_ceo <- fortune_df %>% 
  dplyr::filter(ceo_founder == "yes") %>% 
  nrow() / fortune_df %>%
  nrow() * 100

glue::glue("The percentage of companies who have founder ceo is {percentage_founder_ceo}%.")
```

```{r pie-chart-pct-founder-ceo, echo=TRUE, fig.width=10, fig.height=8}
# Calculate the number of companies with and without a founder CEO
ceo_founder_df <- fortune_df %>% 
  dplyr::group_by(ceo_founder) %>% 
  dplyr::summarise(n = n()) %>% 
  dplyr::mutate(freq = n / sum(n))

# Create the pie chart
ggplot(ceo_founder_df, aes(x = "", y = freq, fill = ceo_founder)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  theme_void() +
  labs(fill = "Founder CEO",
       title = "Percentage of Companies with Founder CEOs") +
  scale_fill_manual(values = c("yes" = "blue", "no" = "red")) +
  geom_text(aes(label = scales::percent(freq)),
            position = position_stack(vjust = 0.5)) +
  theme(
    plot.title = element_text(size = 20, hjust = 0.5, margin = margin(t = 30, r = 0, b = 10, l = 0)),
  )
```
Company with founder CEO's are **only 6%** from the total companies.



**Question 4: What role does profitability play in ranking?**

```{r role-profitability-ranking, echo=TRUE}
# Create a scatter plot to visualize the relationship between profit and rank
ggplot(data = fortune_df) +
  geom_point(mapping = aes(x = rank, y = profit), color = "red") +
  geom_smooth(mapping = aes(x = rank, y = profit), method = "lm", se = FALSE, color = "blue") +
  labs(
    title = "Relationship Between Profit and Rank",
    x = "Rank",
    y = "Profit"
  ) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    plot.title = element_text(size = 20, hjust = 0.5, margin = margin(t = 10, r = 0, b = 10, l = 0))
  )
```

Based on the scatter plot, we can see that there is a **slightly negative correlation between the profit and rank**. It means that only the top 100 companies have a high profit, and the other companies have a low and narrow profit distribution.

**Question 5: What percentage of companies with a market cap over $100 billion?**

```{r percent-company-above-100-billion-market-cap, echo=TRUE}
# Calculate the percentage of companies with a market cap over $100 billion
percentage_above_100_billion <- fortune_df %>% 
  dplyr::filter(market_cap > 100000) %>% 
  nrow() / fortune_df %>%
  nrow() * 100

glue::glue("The percentage of companies with a market cap over $100 billion is {percentage_above_100_billion}%.")

```
```{r pie-chart-pct-market-cap, echo=TRUE, fig.width=10, fig.height=8}
# Calculate the number of companies with a market cap over $100 billion
market_cap_df <- fortune_df %>% 
  dplyr::mutate(market_cap_group = ifelse(market_cap > 100000, "Over $100 Billion", "Under $100 Billion")) %>%
  dplyr::group_by(market_cap_group) %>% 
  dplyr::summarise(n = n()) %>% 
  dplyr::mutate(freq = n / sum(n))

# Create the pie chart
ggplot(market_cap_df, aes(x = "", y = freq, fill = market_cap_group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  theme_void() +
  labs(fill = "Market Cap",
       title = "Percentage of Companies with Market Cap > $100 Billion") +
  scale_fill_manual(values = c("Over $100 Billion" = "blue", "Under $100 Billion" = "red")) +
  geom_text(aes(label = scales::percent(freq)),
            position = position_stack(vjust = 0.5)) +
  theme(
    plot.title = element_text(size = 20, hjust = 0.5, margin = margin(t = 30, r = 0, b = 10, l = 0)),
  )
```

The percentage of company with market cap over $100 billion is **only 7%** from the total companies, this means some of the companies have a very high market cap.


**Question 6: What is the average revenue of companies with a market cap over $100 billion?**

```{r average-revenue-above-100-billion-market-cap, echo=TRUE}
# Calculate the average revenue of companies with a market cap over $100 billion
average_revenue_above_100_billion <- fortune_df %>% 
  dplyr::filter(market_cap > 100000) %>% 
  dplyr::summarise(average_revenue = mean(revenue, na.rm = TRUE))

glue::glue("The average revenue of companies with a market cap over $100 billion is {scales::dollar(average_revenue_above_100_billion$average_revenue)}.")
```

The average revenue of companies with a market cap over $100 billion is **$92,017.60**.

**Question 7: What is the average profit of companies with a market cap over $100 billion?**

```{r average-profit-above-100-billion-market-cap, echo=TRUE}
# Calculate the average profit of companies with a market cap over $100 billion
average_profit_above_100_billion <- fortune_df %>% 
  dplyr::filter(market_cap > 100000) %>% 
  dplyr::summarise(average_profit = mean(profit, na.rm = TRUE))

glue::glue("The average profit of companies with a market cap over $100 billion is {scales::dollar(average_profit_above_100_billion$average_profit)}.")
```
So, the average profit of companies with a market cap over $100 billion is **$15,145.78**.

**Question 8: What is the average number of employees of companies with a market cap over $100 billion?**

```{r average-employees-above-100-billion-market-cap, echo=TRUE}
# Calculate the average number of employees of companies with a market cap over $100 billion
average_employees_above_100_billion <- fortune_df %>% 
  dplyr::filter(market_cap > 100000) %>% 
  dplyr::summarise(average_employees = mean(num_of_employees, na.rm = TRUE))

glue::glue("The average number of employees of companies with a market cap over $100 billion is {scales::comma(average_employees_above_100_billion$average_employees)}.")
```

The average number of employees of companies with a market cap over $100 billion is **168,427**


**Question 9: What is the average rank of companies with a market cap over $100 billion?**

```{r average-rank-above-100-billion-market-cap, echo=TRUE}
# Calculate the average rank of companies with a market cap over $100 billion
average_rank_above_100_billion <- fortune_df %>% 
  dplyr::filter(market_cap > 100000) %>% 
  dplyr::summarise(average_rank = mean(rank, na.rm = TRUE))

glue::glue("The average rank of companies with a market cap over $100 billion is {round(average_rank_above_100_billion$average_rank)}.")
```
**Question 10: What is the sector with the highest market cap?**

```{r sector-highest-market-cap, echo=TRUE}
# Calculate the sector with the highest market cap
sector_highest_market_cap <- fortune_df %>% 
  dplyr::group_by(sector) %>% 
  dplyr::summarise(average_market_cap = mean(market_cap, na.rm = TRUE)) %>% 
  dplyr::arrange(-average_market_cap) %>% 
  head(1)

glue::glue("The sector with the highest market cap is {sector_highest_market_cap$sector} with an average market cap of {scales::dollar(sector_highest_market_cap$average_market_cap)}.")
```

## Summary of Analysis

The analysis of the dataset has been completed, and the following are the key findings:

```{r summary-analysis, echo=FALSE}
summary_df <- data.frame(
  Step = c("Data Cleaning", "Univariate Analysis", "Bivariate Analysis", "Handling Outliers", "Missing Values", "Duplicate Rows"),
  Description = c("The column names were cleaned for consistency and ease of use. The `Market Cap` column was converted to a double data type. Missing values in the `profit`, `num_of_employees`, `ticker`, `prev_rank`, and `market_cap` columns were handled. Invalid values in the `ceo` column were filled with 'Unknown'.",
                  "The distribution of `market_cap`, `revenue`, `profit`, and `num_of_employees` were analyzed. It was found that these distributions are left-skewed, indicating the presence of some companies with very high values in these categories.",
                  "A scatter plot was created to visualize the relationship between `market_cap` and `revenue`.",
                  "Outliers in the `revenue`, `market_cap`, and `profit` columns were not handled as they are common in the business world.",
                  "Missing values in the `Ticker` and `Market Cap` columns were identified. The missing `Ticker` values indicate private companies, while the missing `Market Cap` value needs to be handled as it's important for the analysis. Similarly, missing values in the `profit` and `num. of employees` columns need to be handled.",
                  "The `duplicated()` function was used to check for duplicate rows in the dataset. It was found that there are no duplicate rows.")
)

knitr::kable(summary_df, caption = "Summary of Analysis")
```
